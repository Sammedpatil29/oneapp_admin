<div class="page">

  <header class="header">
  <div class="header-row">
    <div class="title">
      <h1>ğŸ“ˆ Discipline Tracker</h1>
      <p>ğŸ”¥ Small wins. Big discipline.</p>
    </div>

    <div class="user p-1">
        <div class="user">
      <span class="user-name">{{ userName }}</span>
      <span class="user-emoji">{{ userEmoji }}</span>
    </div>
    <div class="user">
      <!-- <span class="user-name">Logout</span> -->
      <span class="user-emoji" title="Logout">â›”</span>
    </div>
    </div>
  </div>
</header>


  <!-- KPI GRID -->
  <section class="kpi-grid advanced">

    <div class="kpi-card highlight">
      <span class="label">ğŸ¯ Discipline Score</span>
      <span class="value">{{ disciplineScore() }}</span>
      <small>/ 100</small>
    </div>

    <div class="kpi-card">
      <span class="label">ğŸ“… Today</span>
      <span class="value">{{ todayPercentage() }}%</span>
    </div>

    <div class="kpi-card">
      <span class="label">ğŸ—“ï¸ Weekly Avg</span>
      <span class="value">{{ weeklyPercentage() }}%</span>
    </div>

    <div class="kpi-card">
      <span class="label">ğŸ“† Monthly Avg</span>
      <span class="value">{{ monthlyPercentage() }}%</span>
    </div>

    <div class="kpi-card">
      <span class="label">ğŸ’ª Strong Task</span>
      <span class="task">
        {{ strongestTask() ? 'ğŸ”¥ ' + strongestTask() : 'â€”' }}
      </span>
    </div>

    <div class="kpi-card">
      <span class="label">âš ï¸ Weak Task</span>
      <span class="task">
        {{ weakestTask() ? 'ğŸ§Š ' + weakestTask() : 'â€”' }}
      </span>
    </div>

    <div class="kpi-card">
      <span class="label">ğŸ”¥ Current Streak</span>
      <span class="value">{{ currentStreak() }}</span>
      <small>days</small>
    </div>

  </section>

  <!-- Heatmap Controls -->
<div class="heatmap-controls">

  <div class="mode-toggle">
    <button
      [class.active]="viewMode === 'day'"
      (click)="setViewMode('day')">Day</button>

    <button
      [class.active]="viewMode === 'week'"
      (click)="setViewMode('week')">Week</button>

    <button
      [class.active]="viewMode === 'month'"
      (click)="setViewMode('month')">Month</button>
  </div>

  <input 
  style="    padding: 6px 8px;
    border-radius: 6px;
    border: 1px solid #d1d5db;"
    type="date"
    [max]="todayStr"
    [(ngModel)]="selectedDate"
    (change)="onViewDateChange()"
  />
</div>
<!-- Heatmap -->
<div class="heatmap"
     [ngClass]="{
       'heatmap-day-view': viewMode === 'day',
       'heatmap-week-view': viewMode === 'week',
       'heatmap-month-view': viewMode === 'month'
     }">

  <div
    class="heatmap-cell"
    *ngFor="let day of heatmapDays"
    [title]="day.date + ' â€¢ ' + day.percent + '%'"
    [ngClass]="getHeatClass(day.percent)">
    <small>{{ day.date | date: 'MMM dd'}}</small>
  </div>

</div>


  
  <!-- Controls Bar -->
<div class="controls">

  <!-- Date Picker -->
  <div class="date-picker">
    <label>ğŸ“… From</label>
    <input
      type="date"
      [max]="todayStr"
      [(ngModel)]="fromDate"
      (change)="onDateChange()"
    />

    <label>â¡ï¸ To</label>
    <input
      type="date"
      [max]="todayStr"
      [(ngModel)]="toDate"
      (change)="onDateChange()"
    />
  </div>

  <!-- Actions -->
  <div class="actions">
    <button class="btn add" (click)="addTaskPrompt()">â• Add Task</button>
    <button class="btn export" (click)="exportCSV()">ğŸ“¤ Export</button>
  </div>

</div>


  <!-- TRACKER TABLE -->
  @if (mockApiResponse['tasks'].length != 0) {
    <section class="table-wrapper">
    <table class="tracker-table">
      <thead>
  <tr>
    <th class="sticky-left">ğŸ“Œ Task</th>
    <th class="sticky-left">ğŸ¯ Target</th>
    <th class="sticky-left">âš™ï¸</th>
    <th *ngFor="let d of dates"
    [class.today-col]="d === todayStr">
  {{ d | date:'dd MMM' }}
  <span *ngIf="d === todayStr">ğŸ“(Today)</span>
</th>   
  </tr>
</thead>

      <tbody>
  <tr *ngFor="let task of tracker.tasks"
      [class.task-disabled]="!task.enabled">

    <!-- Task name -->
    <td class="sticky-left task-name">
      {{ task.enabled ? 'âœ…' : 'â¸ï¸' }} {{ task.name }}
    </td>

    <!-- Frequency -->
    <td class="sticky-left frequency">
      {{ task.weeklyTarget }} / week
    </td>

    <!-- Enable toggle -->
    <td class="sticky-left">
      <label class="switch">
        <input type="checkbox" [(ngModel)]="task.enabled">
        <span class="slider"></span>
      </label>
    </td>

    <!-- Date checkboxes -->
    <td *ngFor="let d of dates"
    [class.today-col]="d === todayStr">

  <input
    class="checkbox"
    type="checkbox"
    [checked]="tracker.isCompleted(task.id, d)"
    (change)="toggle(task, d)"
  />

</td>


  </tr>
</tbody>

    </table>
  </section>
  } @else {
    <small class="add-task">Add Task</small>
  }

</div>

